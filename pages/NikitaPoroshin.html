<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nikita</title>
    <link rel="stylesheet" href="../style/style.css" />
    <link rel="stylesheet" href="../style/Poroshin.css" />
  </head>
  <body>
    <header>
      <form class="for-search-films">
        <input id="input__search" type="text" />
        <button type="submit">Search</button>
      </form>
    </header>
    <main>
      <img
        id="card_loader"
        class="card_loader"
        src="https://media1.giphy.com/media/3oEjI6SIIHBdRxXI40/200w.gif?cid=82a1493bhulo4ig2nhhq0ajbgjh1td34wpplfdmr3rxd8xmy&rid=200w.gif&ct=g"
      />
    </main>
  </body>
  <script>
    window.addEventListener("load", (event) => {
      console.log("page is fully loaded");
      fageFilms("game of");
    });

    const form = document.querySelector(".for-search-films");
    const input = document.getElementById("input__search");

    form.addEventListener("submit", onFormSubmit);

    function onFormSubmit(ev) {
      ev.preventDefault();
      const newInputVal = input.value;
      fageFilms(newInputVal);
      console.log("on form submit", newInputVal);
    }

    function fageFilms(inputValue) {
      window
        .fetch(`https://imdb8.p.rapidapi.com/auto-complete?q="${inputValue}"`, {
          // body: {q: 'game of thr'},
          headers: {
            "X-RapidAPI-Key":
              "11fd48b04dmsh6f8289a439bfd01p1e46ffjsn34c83bfc13b5",
            "X-RapidAPI-Host": "imdb8.p.rapidapi.com",
          },
          method: "GET",
        })
        .then((resp) => resp.json())
        .then((data) => {
          const main = document.querySelector("main");
          const loader = document.getElementById("card_loader");
          if (loader) {
            loader.remove();
          }
          let cards__container = document.querySelector(".cards_container");
          if (cards__container) {
            cards__container.innerHTML = "";
          } else {
            cards__container = document.createElement("div");
            cards__container.classList.add("cards_container");
          }

          main.appendChild(cards__container);
          data.d.map((film) => {
            const card = document.createElement("div");
            card.innerHTML = `
          
              <div class="card">
                <div class="card__name">${film.l}</div>
                <div class="card__year">Year:${film.y}</div>
                <div class="card__rank">Rank:${film.rank}</div>
                <img class="card_img" src="${film.i.imageUrl}" height="${film.i.height}" width="${film.i.width}" >
              </div>
            `;
            cards__container.appendChild(card);
            console.log(film);
          });
        });
    }
  </script>
</html>
